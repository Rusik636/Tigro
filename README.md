# üêØ Tigro ‚Äî Microservice Framework for Telegram Bots

**Tigro** ‚Äî —ç—Ç–æ –º–∏–∫—Ä–æ-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö Telegram-–±–æ—Ç–æ–≤ –≤
–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **FastStream**, **RabbitMQ** –∏ **FastAPI**.
Tigro –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π DSL –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ (`@command`, `@callback`, `@message`) –ø—Ä—è–º–æ –≤–Ω—É—Ç—Ä–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, –Ω–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—è Telegram API –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   - Python 3.10+
   - RabbitMQ
   - FastStream, aiogram, fastapi, pydantic

2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
   ```
   project/
     gBot/           # Gateway-–±–æ—Ç (aiogram)
     tService/       # –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å (–≤–∞—à–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
     lib/tigro/      # Tigro (–ª–æ–∫–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
     shared/         # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –æ–±—â–∏–µ —Å—Ö–µ–º—ã
   ```

3. **–ü—Ä–∏–º–µ—Ä –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞:**
   ```python
   from tigro import ModuleRouter, Context, cb_btn, inline_kb

   router = ModuleRouter()

   @router.command("/start")
   async def start(ctx: Context):
       await ctx.send_message(
           "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ Tigro üëã\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
           markup=inline_kb(
               cb_btn("‚ÑπÔ∏è –ü–æ–º–æ—â—å", "help"),
               cb_btn("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", "settings"),
               row_width=2
           ),
           parse_mode="HTML"
       )

   @router.callback("help")
   async def help_handler(ctx: Context):
       await ctx.edit_message(
           "<b>–ü–æ–º–æ—â—å</b>\n\n–ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥—ë—Ç–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã.",
           markup=inline_kb(cb_btn("–ù–∞–∑–∞–¥", "back")),
           parse_mode="HTML"
       )
   ```

4. **–ü—Ä–∏–º–µ—Ä gateway-–±–æ—Ç–∞ (gBot/main.py):**
   ```python
   from tigro.gateway import run_gateway
   TOKEN = "<your-telegram-token>"
   BROKER_URL = "amqp://guest:guest@localhost/"
   if __name__ == "__main__":
       run_gateway(TOKEN, BROKER_URL)
   ```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **gBot** (gateway):
  - –ü–æ–ª—É—á–∞–µ—Ç Telegram update —á–µ—Ä–µ–∑ aiogram
  - –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ TgEvent –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ RabbitMQ
  - –ü–æ–ª—É—á–∞–µ—Ç TgResponse –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã**:
  - –ü–æ–ª—É—á–∞—é—Ç TgEvent –∏–∑ –æ—á–µ—Ä–µ–¥–∏
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —á–µ—Ä–µ–∑ Tigro Router/Context
  - –§–æ—Ä–º–∏—Ä—É—é—Ç –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ ctx.send_message / ctx.edit_message
  - –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç TgResponse –æ–±—Ä–∞—Ç–Ω–æ –≤ gateway

---

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **Router** ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏–π (command, callback, message)
- **Context** ‚Äî —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã, –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ
- **ModuleRouter** ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –ø–æ –º–æ–¥—É–ª—è–º
- **cb_btn, inline_kb, inline_kb_grid** ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
- **SOLID** ‚Äî –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞

---

## ‚ú® –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ö–æ–º–∞–Ω–¥—ã –∏ –∫–æ–ª–±—ç–∫–∏
```python
@router.command("/start")
async def start(ctx: Context):
    await ctx.send_message("–ü—Ä–∏–≤–µ—Ç!", markup=inline_kb(cb_btn("–ü–æ–º–æ—â—å", "help")))

@router.callback("help")
async def help(ctx: Context):
    await ctx.edit_message("–≠—Ç–æ —Ä–∞–∑–¥–µ–ª –ø–æ–º–æ—â–∏", parse_mode="Markdown")
```

### –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
```python
keyboard = inline_kb(
    cb_btn("–ö–Ω–æ–ø–∫–∞ 1", "cb1"),
    cb_btn("–ö–Ω–æ–ø–∫–∞ 2", "cb2"),
    row_width=2
)
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
```python
await ctx.send_message("<b>–ñ–∏—Ä–Ω—ã–π</b> –∏ <i>–∫—É—Ä—Å–∏–≤</i>", parse_mode="HTML")
await ctx.edit_message("*–ñ–∏—Ä–Ω—ã–π* –∏ _–∫—É—Ä—Å–∏–≤_", parse_mode="Markdown")
```

---

## üõ†Ô∏è –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∏ SOLID
- –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ MessageCommand
- –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –í—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ API –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–∑–∫–∏–µ –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞, —Ç–æ–ª—å–∫–æ –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π

---

## ‚ö° –ü–æ–¥–¥–µ—Ä–∂–∫–∞ parse_mode
- –õ—é–±–æ–π –≤—ã–∑–æ–≤ `send_message` –∏–ª–∏ `edit_message` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `parse_mode` (`"HTML"`, `"Markdown"`)
- –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (disable_web_page_preview –∏ —Ç.–¥.)

---

## üîå –í—ã–±–æ—Ä Telegram-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –¥–ª—è gateway

Tigro –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ Telegram-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ –¥–ª—è gateway-–±–æ—Ç–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è aiogram, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–≤–æ–π –∫–ª–∞—Å—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è Telebot).

**–ü—Ä–∏–º–µ—Ä:**
```python
from tigro.gateway import run_gateway
run_gateway(TOKEN, BROKER_URL, framework="aiogram")  # –∏–ª–∏ framework="telebot"
```

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞:
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–ª–∞—Å—Å, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π—Å—è –æ—Ç BaseGateway (—Å–º. tigro/gateway/base.py)
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ GATEWAY_REGISTRY –≤ tigro/gateway/__init__.py

---

## ‚ùì FAQ

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É/–∫–Ω–æ–ø–∫—É?**
A: –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ö–µ–Ω–¥–ª–µ—Ä —Å –Ω—É–∂–Ω—ã–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ cb_btn/inline_kb.

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π transport?**
A: –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–≤–æ–π ResponsePublisher –∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –µ–≥–æ –≤ Router.

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Å–æ–æ–±—â–µ–Ω–∏—è?**
A: –†–∞—Å—à–∏—Ä—å—Ç–µ MessageCommand –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã-–∫–æ–º–∞–Ω–¥—ã.

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å middleware?**
A: –ü–µ—Ä–µ–¥–∞–π—Ç–µ —Å–ø–∏—Å–æ–∫ middlewares –≤ Router.

---

## üßë‚Äçüíª –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- Telegram: @your_support
- Email: support@example.com

---

## –õ–∏—Ü–µ–Ω–∑–∏—è
MIT

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ 0.1.1

- –£–¥–∞–ª—ë–Ω –º–µ—Ç–æ–¥ `Context.flush`, –æ—Ç–≤–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–∞.

## üîß –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `@command`, `@message`, `@callback` ‚Äî –≤ —Å—Ç–∏–ª–µ `aiogram`
- ‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è `ctx.send_message(...)`, `ctx.edit_message(...)` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: –ø–∞—Ä—Å–∏–Ω–≥ update ‚Äî –≤ `gateway_bot`, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚Äî –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö
- ‚úÖ –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ **RabbitMQ + FastStream** (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ middleware, —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **SOLID**

---
